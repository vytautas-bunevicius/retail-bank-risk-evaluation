<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Application</title>
    <style>
        /* Your existing CSS styles */
        :root {
            --primary: #0666eb;
            --background: #f5f5f5;
            --card-background: #ffffff;
            --text: #333333;
            --border: #e0e0e0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.5;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 480px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--card-background);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        input, select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .btn:hover {
            background-color: #0550b8;
        }
        .btn-group {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
        }
        .progress-step::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -50%;
            right: 50%;
            height: 2px;
            background-color: var(--border);
            z-index: 0;
        }
        .progress-step:first-child::before {
            display: none;
        }
        .progress-step-inner {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            position: relative;
            z-index: 1;
        }
        .progress-step.active .progress-step-inner {
            background-color: var(--primary);
            color: white;
        }
        #result {
            margin-top: 2rem;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        .result-low {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result-medium {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
        }
        .result-high {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Loan Application</h1>
        <div class="progress-bar">
            <div class="progress-step active">
                <div class="progress-step-inner">1</div>
                Personal
            </div>
            <div class="progress-step">
                <div class="progress-step-inner">2</div>
                Financial
            </div>
            <div class="progress-step">
                <div class="progress-step-inner">3</div>
                Loan
            </div>
        </div>
        <form id="loanForm">
            <div class="form-step active" id="step1">
                <div class="form-group">
                    <label for="code_gender">Gender</label>
                    <select id="code_gender" name="code_gender" required>
                        <option value="">Select gender</option>
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="days_birth">Age (in years)</label>
                    <input type="number" id="days_birth" name="days_birth" required min="18" max="100">
                </div>
                <div class="form-group">
                    <label for="name_education_type">Education Level</label>
                    <select id="name_education_type" name="name_education_type" required>
                        <option value="">Select education level</option>
                        <option value="Lower secondary">Lower secondary</option>
                        <option value="Secondary / secondary special">Secondary / secondary special</option>
                        <option value="Incomplete higher">Incomplete higher</option>
                        <option value="Higher education">Higher education</option>
                        <option value="Academic degree">Academic degree</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="name_family_status">Family Status</label>
                    <select id="name_family_status" name="name_family_status" required>
                        <option value="">Select family status</option>
                        <option value="Single / not married">Single / not married</option>
                        <option value="Married">Married</option>
                        <option value="Civil marriage">Civil marriage</option>
                        <option value="Separated">Separated</option>
                        <option value="Widow">Widow</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn" onclick="nextStep(1)">Next</button>
                </div>
            </div>
            <div class="form-step" id="step2">
                <div class="form-group">
                    <label for="amt_income_total">Total Income</label>
                    <input type="number" id="amt_income_total" name="amt_income_total" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label for="name_income_type">Income Type</label>
                    <select id="name_income_type" name="name_income_type" required>
                        <option value="">Select income type</option>
                        <option value="Working">Working</option>
                        <option value="Commercial associate">Commercial associate</option>
                        <option value="Pensioner">Pensioner</option>
                        <option value="State servant">State servant</option>
                        <option value="Student">Student</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="name_housing_type">Housing Type</label>
                    <select id="name_housing_type" name="name_housing_type" required>
                        <option value="">Select housing type</option>
                        <option value="House / apartment">House / apartment</option>
                        <option value="With parents">With parents</option>
                        <option value="Municipal apartment">Municipal apartment</option>
                        <option value="Rented apartment">Rented apartment</option>
                        <option value="Office apartment">Office apartment</option>
                        <option value="Co-op apartment">Co-op apartment</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="flag_own_car">Do you own a car?</label>
                    <select id="flag_own_car" name="flag_own_car" required>
                        <option value="">Select option</option>
                        <option value="Y">Yes</option>
                        <option value="N">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="flag_own_realty">Do you own real estate?</label>
                    <select id="flag_own_realty" name="flag_own_realty" required>
                        <option value="">Select option</option>
                        <option value="Y">Yes</option>
                        <option value="N">No</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn" onclick="prevStep(2)">Previous</button>
                    <button type="button" class="btn" onclick="nextStep(2)">Next</button>
                </div>
            </div>
            <div class="form-step" id="step3">
                <div class="form-group">
                    <label for="amt_credit">Credit Amount</label>
                    <input type="number" id="amt_credit" name="amt_credit" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label for="amt_annuity">Annuity Amount</label>
                    <input type="number" id="amt_annuity" name="amt_annuity" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label for="amt_goods_price">Goods Price</label>
                    <input type="number" id="amt_goods_price" name="amt_goods_price" required min="0" step="0.01">
                </div>
                <div class="btn-group">
                    <button type="button" class="btn" onclick="prevStep(3)">Previous</button>
                    <button type="submit" class="btn">Submit Application</button>
                </div>
            </div>
        </form>
        <div id="result"></div>
    </div>
    <script>
        const form = document.getElementById('loanForm');
        const result = document.getElementById('result');
        const steps = document.querySelectorAll('.form-step');
        const progressSteps = document.querySelectorAll('.progress-step');

        function nextStep(currentStep) {
            steps[currentStep - 1].classList.remove('active');
            steps[currentStep].classList.add('active');
            progressSteps[currentStep].classList.add('active');
        }

        function prevStep(currentStep) {
            steps[currentStep - 1].classList.remove('active');
            steps[currentStep - 2].classList.add('active');
            progressSteps[currentStep - 1].classList.remove('active');
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            data.days_birth = -Math.abs(data.days_birth * 365); // Convert years to negative days

            // Convert numeric fields to appropriate types
            data.amt_income_total = parseFloat(data.amt_income_total);
            data.amt_credit = parseFloat(data.amt_credit);
            data.amt_annuity = parseFloat(data.amt_annuity);
            data.amt_goods_price = parseFloat(data.amt_goods_price);
            data.days_birth = parseInt(data.days_birth);

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'An error occurred.');
                }

                const prediction = await response.json();
                displayResult(prediction.probability_of_default);
            } catch (error) {
                console.error('Error:', error);
                result.textContent = `Error: ${error.message}`;
                result.className = '';
            }
        });

        function displayResult(probability) {
            const percentage = (probability * 100).toFixed(2);
            let riskLevel, cssClass;
            if (probability < 0.3) {
                riskLevel = 'Low';
                cssClass = 'result-low';
            } else if (probability < 0.6) {
                riskLevel = 'Medium';
                cssClass = 'result-medium';
            } else {
                riskLevel = 'High';
                cssClass = 'result-high';
            }
            result.innerHTML = `
                <h2>Loan Application Result</h2>
                <p>Probability of Default: ${percentage}%</p>
                <p>Risk Level: ${riskLevel}</p>
            `;
            result.className = cssClass;
        }
    </script>
</body>
</html>
